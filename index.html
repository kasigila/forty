<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#6E7F5F" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <meta name="apple-mobile-web-app-title" content="Forty" />
  <meta name="description" content="Forty — A Lent Companion. Track fasting, prayer, and reflections through 40 days." />
  <title>Forty — A Lent Companion</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png" />
  <link rel="icon" type="image/png" href="assets/icons/icon-192.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400&family=Inter:wght@400;500;600&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="toast-container" class="toast-container" aria-live="polite"></div>
  <div id="app">
    <!-- Onboarding -->
    <section id="onboarding" class="view" data-view="onboarding">
      <div class="onboarding-container">
        <div class="onboarding-step" data-step="welcome">
          <h1 class="serif-title">Forty</h1>
          <p class="tagline">A Lent Companion</p>
          <p class="onboarding-desc">A gentle companion for your 40-day journey of fasting, prayer, and reflection.</p>
          <button type="button" class="btn-primary" data-next>Begin</button>
        </div>
        <div class="onboarding-step hidden" data-step="dates">
          <h2 class="serif-heading">When does your Lent begin?</h2>
          <p class="onboarding-desc">Select your start date</p>
          <input type="date" id="start-date" class="input-date" required />
          <button type="button" class="btn-primary" data-next>Continue</button>
        </div>
        <div class="onboarding-step hidden" data-step="commitments">
          <h2 class="serif-heading">Your commitments</h2>
          <p class="onboarding-desc">What are you giving up? What are you adding?</p>
          <label class="input-label">What I'm giving up</label>
          <input type="text" id="giving-up" class="input-text" placeholder="e.g. Social media, sweets..." maxlength="80" />
          <label class="input-label">What I'm adding</label>
          <input type="text" id="adding" class="input-text" placeholder="e.g. Morning prayer, reading..." maxlength="80" />
          <button type="button" class="btn-primary" data-next>Continue</button>
        </div>
        <div class="onboarding-step hidden" data-step="why">
          <h2 class="serif-heading">Why are you doing this?</h2>
          <p class="onboarding-desc">A reminder for moments when it gets hard</p>
          <textarea id="why-text" class="input-textarea" placeholder="Write your why..." rows="4" maxlength="500"></textarea>
          <button type="button" class="btn-primary" data-next>Continue</button>
        </div>
        <div class="onboarding-step hidden" data-step="tone">
          <h2 class="serif-heading">How would you like us to speak to you?</h2>
          <p class="onboarding-desc">Choose your tone preference</p>
          <div class="tone-options">
            <button type="button" class="tone-btn" data-tone="gentle">Gentle</button>
            <button type="button" class="tone-btn" data-tone="direct">Direct</button>
            <button type="button" class="tone-btn" data-tone="strict">Strict</button>
          </div>
          <button type="button" class="btn-primary" data-next>Start Lent</button>
        </div>
      </div>
      <div class="onboarding-progress">
        <span class="step-dot" data-dot="0"></span>
        <span class="step-dot" data-dot="1"></span>
        <span class="step-dot" data-dot="2"></span>
        <span class="step-dot" data-dot="3"></span>
        <span class="step-dot" data-dot="4"></span>
      </div>
    </section>

    <!-- Main App -->
    <main id="main-app" class="view hidden" data-view="main">
      <!-- Tab Bar -->
      <nav class="tab-bar" role="tablist">
        <button type="button" class="tab-btn active" role="tab" data-tab="dashboard" aria-selected="true">
          <span class="tab-icon"><i class="fa-solid fa-house"></i></span>
          <span class="tab-label">Home</span>
        </button>
        <button type="button" class="tab-btn" role="tab" data-tab="checkin" aria-selected="false">
          <span class="tab-icon"><i class="fa-solid fa-pen-to-square"></i></span>
          <span class="tab-label">Log</span>
        </button>
        <button type="button" class="tab-btn" role="tab" data-tab="calendar" aria-selected="false">
          <span class="tab-icon"><i class="fa-solid fa-calendar-days"></i></span>
          <span class="tab-label">Calendar</span>
        </button>
        <button type="button" class="tab-btn" role="tab" data-tab="analytics" aria-selected="false">
          <span class="tab-icon"><i class="fa-solid fa-chart-line"></i></span>
          <span class="tab-label">Stats</span>
        </button>
        <button type="button" class="tab-btn" role="tab" data-tab="journal" aria-selected="false">
          <span class="tab-icon"><i class="fa-solid fa-book-open"></i></span>
          <span class="tab-label">Journal</span>
        </button>
        <button type="button" class="tab-btn" role="tab" data-tab="settings" aria-selected="false">
          <span class="tab-icon"><i class="fa-solid fa-gear"></i></span>
          <span class="tab-label">Settings</span>
        </button>
      </nav>

      <!-- Dashboard -->
      <section id="dashboard" class="panel active" data-panel="dashboard" aria-hidden="false">
        <header class="panel-header">
          <h1 class="serif-title">Forty</h1>
          <button type="button" class="icon-btn emergency-trigger" title="I'm struggling"><i class="fa-solid fa-hand-holding-heart"></i></button>
        </header>
        <div class="dashboard-content">
          <div class="commitments-reminder" id="commitments-reminder">
            <p class="commitments-line" id="giving-up-line"></p>
            <p class="commitments-line" id="adding-line"></p>
          </div>
          <div class="day-counter">
            <div class="progress-ring" role="progressbar">
              <svg viewBox="0 0 120 120" class="ring-svg">
                <circle class="ring-bg" cx="60" cy="60" r="54" />
                <circle class="ring-fill" cx="60" cy="60" r="54" />
              </svg>
              <div class="ring-center">
                <span class="day-num" id="day-num">1</span>
                <span class="day-of">of 40</span>
              </div>
            </div>
          </div>
          <div class="streak-display">
            <span class="streak-value" id="streak-value">0</span>
            <span class="streak-label">day streak</span>
          </div>
          <div class="scripture-block">
            <p class="scripture-text" id="scripture-text"></p>
            <cite class="scripture-ref" id="scripture-ref"></cite>
            <button type="button" class="btn-text btn-save-verse" id="btn-save-verse">Save verse to journal</button>
          </div>
          <div class="daily-prompt-block" id="daily-prompt-block">
            <h3 class="prompt-heading">Today&rsquo;s reflection</h3>
            <p class="daily-prompt" id="daily-prompt"></p>
          </div>
          <div class="wisdom-block" id="wisdom-block">
            <p class="wisdom-text" id="wisdom-text"></p>
          </div>
          <div class="prayer-intentions-compact" id="prayer-intentions-compact"></div>
          <button type="button" class="btn-text btn-stations" id="btn-stations"><i class="fa-solid fa-cross"></i> Stations of the Cross</button>
          <button type="button" class="btn-primary btn-log" id="btn-log-today">Log Today</button>
          <button type="button" class="btn-secondary emergency-trigger" id="emergency-quick">I'm struggling</button>
        </div>
      </section>

      <!-- Daily Check-In (panel with trigger for modal) -->
      <section id="checkin" class="panel" data-panel="checkin" aria-hidden="true">
        <header class="panel-header">
          <h2 class="serif-heading">Daily Check-In</h2>
        </header>
        <div class="checkin-panel-content">
          <p class="checkin-panel-desc">Log your fasting, prayer, scripture, and reflection for today.</p>
          <div class="today-status" id="today-status"></div>
          <button type="button" class="btn-primary" id="btn-open-checkin-modal">Log Today</button>
        </div>
      </section>

      <!-- Calendar -->
      <section id="calendar" class="panel" data-panel="calendar" aria-hidden="true">
        <header class="panel-header">
          <h2 class="serif-heading">40-Day Calendar</h2>
        </header>
        <div class="calendar-content">
          <div class="calendar-grid" id="calendar-grid"></div>
        </div>
      </section>

      <!-- Analytics -->
      <section id="analytics" class="panel" data-panel="analytics" aria-hidden="true">
        <header class="panel-header">
          <h2 class="serif-heading">Analytics</h2>
        </header>
        <div class="analytics-content">
          <div class="discipline-score-card">
            <span class="score-value" id="discipline-score">—</span>
            <span class="score-label" id="discipline-label">Discipline Score</span>
          </div>
          <div class="chart-block">
            <h3>Last 14 days</h3>
            <p class="chart-desc">Disciplines completed each day (fast, prayer, scripture)</p>
            <div class="streak-chart" id="streak-chart"></div>
          </div>
          <div class="stats-grid">
            <div class="stat-card">
              <span class="stat-value" id="weekly-pct">—</span>
              <span class="stat-label">Weekly completion</span>
            </div>
            <div class="stat-card">
              <span class="stat-value" id="failure-day">—</span>
              <span class="stat-label">Hardest day</span>
            </div>
          </div>
          <div class="chart-block">
            <h3>Mood distribution</h3>
            <p class="chart-desc">How you've felt across your check-ins</p>
            <div class="mood-chart" id="mood-chart"></div>
          </div>
          <div class="chart-block" id="mood-discipline-block">
            <h3>Mood vs discipline</h3>
            <p class="chart-desc">Completion rate when you felt each way</p>
            <div class="mood-discipline-chart" id="mood-discipline-chart"></div>
          </div>
          <div class="stats-grid" id="best-time-row">
            <div class="stat-card">
              <span class="stat-value" id="best-time">—</span>
              <span class="stat-label">Best time to log</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Reflection Journal -->
      <section id="journal" class="panel" data-panel="journal" aria-hidden="true">
        <header class="panel-header">
          <h2 class="serif-heading">Reflection Journal</h2>
          <button type="button" class="btn-text" id="btn-export">Export</button>
        </header>
        <div class="journal-content">
          <button type="button" class="btn-primary btn-new-entry" id="btn-new-journal-entry">New entry</button>
          <div class="journal-timeline" id="journal-timeline"></div>
        </div>
      </section>

      <!-- Settings -->
      <section id="settings" class="panel" data-panel="settings" aria-hidden="true">
        <header class="panel-header">
          <h2 class="serif-heading">Settings</h2>
        </header>
        <div class="settings-content">
          <div class="settings-group">
            <h3>Commitments</h3>
            <div class="commitments-display" id="commitments-display">
              <p class="commitments-setting-line" id="settings-giving-up"></p>
              <p class="commitments-setting-line" id="settings-adding"></p>
            </div>
            <button type="button" class="settings-row settings-row-btn" id="edit-commitments">Edit commitments</button>
          </div>
          <div class="settings-group">
            <h3>Appearance</h3>
            <div class="settings-row">
              <span>Dark mode</span>
              <label class="toggle">
                <input type="checkbox" id="toggle-dark" />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <div class="settings-group">
            <h3>Tone</h3>
            <div class="tone-inline">
              <button type="button" class="tone-btn small" data-tone="gentle">Gentle</button>
              <button type="button" class="tone-btn small" data-tone="direct">Direct</button>
              <button type="button" class="tone-btn small" data-tone="strict">Strict</button>
            </div>
          </div>
          <div class="settings-group">
            <h3>Prayer intentions</h3>
            <div class="prayer-intentions-list" id="prayer-intentions-list"></div>
            <div class="prayer-add-row">
              <input type="text" id="prayer-intention-input" class="input-text" placeholder="Add a prayer intention..." maxlength="100" />
              <button type="button" class="btn-secondary btn-sm" id="btn-add-prayer">Add</button>
            </div>
          </div>
          <div class="settings-group">
            <h3>Reminder</h3>
            <div class="settings-row">
              <span>Daily reminder</span>
              <input type="time" id="reminder-time" class="input-time" />
            </div>
          </div>
          <div class="settings-group">
            <h3>Fasting schedule</h3>
            <select id="fasting-schedule" class="input-select">
              <option value="all">All days (Mon–Sun)</option>
              <option value="weekdays">Weekdays only</option>
              <option value="custom">Custom (see notes)</option>
            </select>
          </div>
          <div class="settings-group">
            <h3>Data</h3>
            <button type="button" class="settings-row settings-row-btn" id="import-data">Import data</button>
            <input type="file" id="import-file-input" class="hidden" accept=".json,application/json" />
            <button type="button" class="settings-row settings-row-btn" id="export-data">Export data</button>
            <button type="button" class="settings-row settings-row-btn" id="btn-share-completion">Share completion</button>
            <button type="button" class="settings-row settings-row-btn danger" id="reset-lent">Reset Lent</button>
          </div>
        </div>
      </section>
    </main>

    <!-- Daily Check-In Modal (slide-up) -->
    <div id="checkin-modal" class="modal hidden">
      <div class="modal-backdrop" data-close-modal></div>
      <div class="modal-content modal-slide checkin-modal-content">
        <div class="modal-header">
          <h2>Log Today</h2>
          <button type="button" class="modal-close" aria-label="Close" data-close-modal><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body checkin-form" id="modal-checkin-body">
          <p class="checkin-date" id="checkin-date"></p>
          <div class="toggle-group">
            <div class="toggle-row">
              <span>Fast kept</span>
              <label class="toggle">
                <input type="checkbox" id="toggle-fast" />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span>Prayer completed</span>
              <label class="toggle">
                <input type="checkbox" id="toggle-prayer" />
                <span class="toggle-slider"></span>
              </label>
            </div>
            <div class="toggle-row">
              <span>Scripture read</span>
              <label class="toggle">
                <input type="checkbox" id="toggle-scripture" />
                <span class="toggle-slider"></span>
              </label>
            </div>
          </div>
          <label class="input-label">Mood</label>
          <div class="mood-selector" id="mood-selector">
            <button type="button" class="mood-btn" data-mood="peaceful" title="Peaceful"><i class="fa-solid fa-sun"></i></button>
            <button type="button" class="mood-btn" data-mood="grateful" title="Grateful"><i class="fa-solid fa-heart"></i></button>
            <button type="button" class="mood-btn" data-mood="neutral" title="Neutral"><i class="fa-regular fa-circle"></i></button>
            <button type="button" class="mood-btn" data-mood="struggling" title="Struggling"><i class="fa-solid fa-cloud"></i></button>
            <button type="button" class="mood-btn" data-mood="tempted" title="Tempted"><i class="fa-solid fa-moon"></i></button>
          </div>
          <label class="input-label">Reflection</label>
          <textarea id="checkin-reflection" class="input-textarea" placeholder="Today's reflection..." rows="4"></textarea>
          <button type="button" class="btn-primary" id="btn-save-checkin">Save</button>
        </div>
      </div>
    </div>

    <!-- Emergency Mode (full-screen page) -->
    <div id="emergency-overlay" class="emergency-overlay hidden">
      <div class="emergency-content">
        <h2 class="emergency-title">You&rsquo;re not alone</h2>
        <p class="emergency-intro">Take a moment. Breathe. Remember why you began.</p>
        <div class="emergency-scripture-block">
          <p class="emergency-scripture" id="emergency-scripture"></p>
          <cite class="emergency-ref" id="emergency-ref"></cite>
        </div>
        <p class="emergency-verse-note">A new verse each time you open this page.</p>
        <div class="emergency-why">
          <h3>Why you started</h3>
          <p id="emergency-why-text"></p>
        </div>
        <div class="breathing-timer">
          <h3>Ground yourself</h3>
          <p class="breath-desc">Follow the circle. Breathe in for 4 seconds, out for 4 seconds.</p>
          <div class="breath-circle" id="breath-circle"></div>
          <p class="breath-label" id="breath-label">Breathe in</p>
          <span class="breath-countdown" id="breath-countdown">60</span>
          <span class="breath-unit">seconds</span>
        </div>
        <button type="button" class="btn-primary" id="emergency-close">Close and Stay Strong</button>
      </div>
    </div>

    <!-- New Journal Entry Modal -->
    <div id="journal-entry-modal" class="modal hidden">
      <div class="modal-backdrop" data-close-journal-entry></div>
      <div class="modal-content modal-slide checkin-modal-content">
        <div class="modal-header">
          <h2>New journal entry</h2>
          <button type="button" class="modal-close" aria-label="Close" data-close-journal-entry><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body checkin-form">
          <label class="input-label">Date</label>
          <input type="date" id="journal-entry-date" class="input-date" />
          <label class="input-label">Mood</label>
          <div class="mood-selector" id="journal-mood-selector">
            <button type="button" class="mood-btn" data-mood="peaceful" title="Peaceful"><i class="fa-solid fa-sun"></i></button>
            <button type="button" class="mood-btn" data-mood="grateful" title="Grateful"><i class="fa-solid fa-heart"></i></button>
            <button type="button" class="mood-btn" data-mood="neutral" title="Neutral"><i class="fa-regular fa-circle"></i></button>
            <button type="button" class="mood-btn" data-mood="struggling" title="Struggling"><i class="fa-solid fa-cloud"></i></button>
            <button type="button" class="mood-btn" data-mood="tempted" title="Tempted"><i class="fa-solid fa-moon"></i></button>
          </div>
          <label class="input-label">Scripture (optional)</label>
          <input type="text" id="journal-entry-scripture" class="input-text" placeholder="e.g. Psalm 51:10" />
          <label class="input-label">Reflection</label>
          <textarea id="journal-entry-reflection" class="input-textarea" placeholder="Write your reflection..." rows="5"></textarea>
          <button type="button" class="btn-primary" id="btn-save-journal-entry">Save</button>
        </div>
      </div>
    </div>

    <!-- Edit Commitments Modal -->
    <div id="edit-commitments-modal" class="modal edit-commitments-modal hidden">
      <div class="modal-backdrop" data-close-edit-commitments></div>
      <div class="modal-content modal-slide checkin-modal-content">
        <div class="modal-header">
          <h2>Edit commitments</h2>
          <button type="button" class="modal-close" aria-label="Close" data-close-edit-commitments><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body">
          <label class="input-label">What I&rsquo;m giving up</label>
          <input type="text" id="edit-giving-up" class="input-text" placeholder="e.g. Social media, sweets..." maxlength="80" />
          <label class="input-label">What I&rsquo;m adding</label>
          <input type="text" id="edit-adding" class="input-text" placeholder="e.g. Morning prayer, reading..." maxlength="80" />
          <button type="button" class="btn-primary" id="btn-save-commitments">Save</button>
        </div>
      </div>
    </div>

    <!-- Stations of the Cross Modal -->
    <div id="stations-modal" class="modal hidden">
      <div class="modal-backdrop" data-close-stations></div>
      <div class="modal-content modal-slide stations-modal-content">
        <div class="modal-header">
          <h2>Stations of the Cross</h2>
          <button type="button" class="modal-close" aria-label="Close" data-close-stations><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body stations-body" id="stations-body"></div>
      </div>
    </div>

    <!-- Milestone Modal (Day 10, 20, 30) -->
    <div id="milestone-modal" class="modal hidden">
      <div class="modal-backdrop" data-close-milestone></div>
      <div class="modal-content milestone-modal-content">
        <h2 class="serif-title" id="milestone-title"></h2>
        <p class="milestone-message" id="milestone-message"></p>
        <button type="button" class="btn-primary" id="milestone-dismiss" data-close-milestone>Continue</button>
      </div>
    </div>

    <!-- Share Completion Modal -->
    <div id="share-modal" class="modal hidden">
      <div class="modal-backdrop" data-close-share></div>
      <div class="modal-content share-modal-content">
        <div class="modal-header">
          <h2>Share your completion</h2>
          <button type="button" class="modal-close" aria-label="Close" data-close-share><i class="fa-solid fa-xmark"></i></button>
        </div>
        <div class="modal-body">
          <textarea id="share-text" class="input-textarea" rows="6" readonly></textarea>
          <button type="button" class="btn-primary" id="btn-copy-share">Copy to clipboard</button>
        </div>
      </div>
    </div>

    <!-- Easter Summary -->
    <div id="easter-summary" class="modal hidden">
      <div class="modal-backdrop" data-close-easter></div>
      <div class="modal-content easter-modal">
        <h2 class="serif-title">You did it.</h2>
        <p class="easter-message">40 days complete. May this journey stay with you.</p>
        <button type="button" class="btn-primary" id="easter-dismiss" data-close-easter>Continue</button>
      </div>
    </div>
  </div>

  <script src="js/storage.js"></script>
  <script src="js/content.js"></script>
  <script src="js/analytics.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/router.js"></script>
  <script src="js/app.js"></script>
</body>
</html>
